<root>
	<styles>
		<include src="s2r://panorama/styles/dotastyles.vcss_c" />
		<include src="file://{resources}/styles/custom_game/equip_list.css" />
	</styles>
	<script>
		function OnBuffClicked()
		{
			var queryUnit = Players.GetPlayerHeroEntityIndex( Players.GetLocalPlayer() );
			var buffSerial = $.GetContextPanel().m_BuffSerial;

			if (!buffSerial || !buffSerial) 
			{
				return;
			}

			Game.EmitSound("ui.inv_unequip");

			GameEvents.SendCustomGameEventToServer( "player_buff_clicked", { "pID" : Players.GetLocalPlayer(), "entityID" : queryUnit, "buffName" : $.GetContextPanel().m_BuffName } )

			$.GetContextPanel().m_BuffName = undefined;
			$.GetContextPanel().m_BuffSerial = undefined;
			$.GetContextPanel().m_ItemImage.visibility = "collapse;";
		}

		function BuffShowTooltip()
		{
			var queryUnit = Players.GetPlayerHeroEntityIndex( Players.GetLocalPlayer() );
			var buffSerial = $.GetContextPanel().m_BuffSerial;

			if (!queryUnit || !buffSerial) return;

			var isEnemy = Entities.IsEnemy( queryUnit );
			$.DispatchEvent( "DOTAShowBuffTooltip", $.GetContextPanel(), queryUnit, buffSerial, false );
		}

		function BuffHideTooltip()
		{
			$.DispatchEvent( "DOTAHideBuffTooltip", $.GetContextPanel() );
		}

		(function () {
			$.GetContextPanel().m_ItemImage = $("#ItemImage");
		})();
	</script>
	<Panel class="BuffRoot HiddenBuff" hittest="false">
		<Button id="BuffFrame"
							onactivate="OnBuffClicked()"
							onmouseover="BuffShowTooltip()"
							onmouseout="BuffHideTooltip()"
							>
			<Panel id="BuffImage">
				<!-- <DOTAAbilityImage id="AbilityImage" /> -->
				<DOTAItemImage id="ItemImage" scaling="stretch-to-fit-y-preserve-aspect" />
			</Panel>
			<Label id="StackCount" />
		</Button>
	</Panel>
</root>

